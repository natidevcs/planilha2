<div class='pagina'>
    <div class='conteudo'>
      <h1>Planilha de gastos</h1>
  
      <div class='informacao'>
        <p id='saldo'>Carregando saldo...</p>
      </div>
  
      <table class='lista-transacoes'>
        <thead>
          <th class='coluna-descricao'>
            <h3>DESCRIÇÃO</h3>
          </th>
          <th class='coluna-categoria'>
            <h3>CATEGORIA</h3>
          </th>
          <th class='coluna-valor'>
            <h3>VALOR</h3>
          </th>
        </thead>
        <tbody id='lista-transacoes-conteudo'>
          <tr>
            <td>Carregando dados...</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class='botoes'>
      <button class='despesa' id='botao-despesa'>Adicionar despesa</button>
      <button class='receita' id='botao-receita'>Adicionar receita</button>
    </div>
  </div>
  <style type="text/css">

    @import url('https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;700&display=swap');
    
    * {
      font-family: 'Source Sans 3', sans-serif;
      color: #2f2f33;
      margin: 0 auto;
    }
    
    .pagina {
      max-width: 896px;
      padding: 0 16px;
      height: 100vh;
    
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .conteudo {
      width: 100%;
    
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    h1 {
      font-size: 51px;
      font-weight: bold;
      margin-top: 40px;
      margin-bottom: 56px;
    }
    
    .informacao {
      width: 100%;
      text-align: center;
      background-color: #F5F6FA;
      padding: 16px 0;
      border-radius: 8px;
      margin-bottom: 40px;
    }
    
    .informacao p {
      font-size: 19px;
      font-weight: bold;
    }
    
    .lista-transacoes {
      width: 100%;
    }
    
    .lista-transacoes .coluna-descricao {
      text-align: left;
    }
    
    .lista-transacoes .coluna-categoria {
      text-align: center;
      text-transform: capitalize;
    }
    
    .lista-transacoes .coluna-valor {
      text-align: right;
    }
    
    .lista-transacoes th {
      padding: 8px 0;
    }
    
    .lista-transacoes td {
      padding: 16px 0;
    }
    
    .lista-transacoes h3 {
      font-size: 14px;
      color: #757680;
    }
    
    .botoes {
      padding: 24px 0;
    }
    
    .botoes button {
      padding: 8px 24px;
      border: 0;
      border-radius: 8px;
      font-weight: 500;
      line-height: 24px;
      font-size: 18px;
      min-width: 200px;
      cursor: pointer;
      letter-spacing: 0.4px;
    }
    
    .botoes button:hover {
      transform: scale(1.0175);
      opacity: 0.9;
    }
    
    .botoes .despesa {
      background-color: #fff;
      color: #E02B57;
    }
    
    .botoes .receita {
      background-color: #E02B57;
      color: #fff;
    }
    
    @media only screen and (max-width: 600px) {
      .botoes,
      .botoes button {
        width: 100%;
      }
    }
    </style>
    <script>
    function formatarValor(valor) {
    return valor.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' });
  }
  
  function setSaldo(saldo) {
    const saldoConteudo = document.createTextNode('Saldo: ' + formatarValor(saldo));
    const saldoElement = document.getElementById('saldo');
    saldoElement.replaceChildren(saldoConteudo);
  }
  
  function criarTransacao(transacao) {
    const linha = document.createElement('tr');
    
    const descricaoElement = document.createElement('td');
    descricaoElement.setAttribute('class', 'coluna-descricao');
    descricaoElement.append(transacao.descricao);
    linha.append(descricaoElement);
    
    const categoriaElement = document.createElement('td');
    categoriaElement.setAttribute('class', 'coluna-categoria');
    categoriaElement.append(transacao.categoria);
    linha.append(categoriaElement);
    
    const valorElement = document.createElement('td');
    valorElement.setAttribute('class', 'coluna-valor');
    valorElement.append(formatarValor(transacao.valor));
    linha.append(valorElement);
    
    return linha;
  }
  
  function setTransacoes(transacoes) {
    const tabelaConteudo = document.createElement('tbody');
    tabelaConteudo.setAttribute('id', 'lista-transacoes-conteudo');
  
    transacoes.forEach((transacao) => {
      const linha = criarTransacao(transacao);
      tabelaConteudo.append(linha);
    });
    
    document.getElementById('lista-transacoes-conteudo').replaceWith(tabelaConteudo);
  }
  
  async function buscarTransacoes() {
    const response = await fetch('https://3000-natidevcs-planilha2-2m2mgom32pa.ws-us62.gitpod.io/transacoes');
    const financas = await response.json();
    
    //setSaldo(financas.saldo);
    setTransacoes(financas.transacoes);
  }
  
  async function enviarDadosTransacao(descricao, valor, categoria) {
    if (valor.indexOf(',') > 0) {
      alert('Você deve digitar números com o símbolo decimal ponto, e não vírgula');
      return;
    }
    
    if (isNaN(valor)) {
      alert('Você deve digitar um número no campo valor!');
      return;
    }
    
    const transacao = { descricao, valor: Number(valor), categoria };
    console.log('transacao ' + JSON.stringify(transacao))
    const requisicao = {
      method: 'POST',
      body: JSON.stringify(transacao),
      headers: {
        "content-type": "application/json"
      }
    };
    await fetch('/transacoes', requisicao);
  }
  
  async function adicionarDespesa() {
    const descricaoDespesa = window.prompt('Qual a descricao de sua despesa?');
    const valorDespesa = window.prompt('Qual o valor de sua despesa?');
  
    await enviarDadosTransacao(descricaoDespesa, valorDespesa, "Despesa");
    
    buscarTransacoes();
  }
  
  async function adicionarReceita() {
    const descricaoReceita = window.prompt('Qual a descricao de sua receita?');
    const valorReceita = window.prompt('Qual o valor de sua receita?');
  
    await enviarDadosTransacao(descricaoReceita, valorReceita, "Receita");
    
    buscarTransacoes();
  }
  
  document.getElementById('botao-despesa').addEventListener('click', adicionarDespesa);
  document.getElementById('botao-receita').addEventListener('click', adicionarReceita);
  
  buscarTransacoes();
    </script>